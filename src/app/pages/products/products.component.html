<div class="products-container">
  <!-- Header da Página -->
  <div class="page-header">
    <div class="header-content">
      <h1>Gestão de Produtos e Estoque</h1>
      <div class="header-actions">
        <button class="btn-secondary" (click)="createSupplier()">
          <i class="fas fa-plus"></i>
          Novo Fornecedor
        </button>
        <!-- <button class="btn-secondary" (click)="createStockMovement()">
          <i class="fas fa-plus"></i>
          Movimentação
        </button> -->
        <button class="btn-primary" (click)="createProduct()">
          <i class="fas fa-plus"></i>
          Novo Produto
        </button>
      </div>
    </div>
  </div>

  <!-- Estatísticas -->
  <div class="stats-section">
    <div class="stat-card">
      <div class="stat-icon">
        <i class="fas fa-boxes"></i>
      </div>
      <div class="stat-content">
        <h3>{{ stats.totalProducts }}</h3>
        <p>Total de Produtos</p>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon active">
        <i class="fas fa-check-circle"></i>
      </div>
      <div class="stat-content">
        <h3>{{ stats.activeProducts }}</h3>
        <p>Produtos Ativos</p>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon warning">
        <i class="fas fa-exclamation-triangle"></i>
      </div>
      <div class="stat-content">
        <h3>{{ stats.lowStockProducts }}</h3>
        <p>Estoque Baixo</p>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon error">
        <i class="fas fa-times-circle"></i>
      </div>
      <div class="stat-content">
        <h3>{{ stats.outOfStockProducts }}</h3>
        <p>Sem Estoque</p>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon revenue">
        <i class="fas fa-dollar-sign"></i>
      </div>
      <div class="stat-content">
        <h3>{{ formatCurrency(stats.totalValue) }}</h3>
        <p>Valor Total</p>
      </div>
    </div>
  </div>

  <!-- Filtros e Busca -->
  <div class="filters-section">
    <div class="search-box">
      <i class="fas fa-search"></i>
      <input 
        type="text" 
        placeholder="Buscar por nome, descrição ou SKU..."
        [(ngModel)]="searchTerm"
        (input)="onSearchChange()"
        class="search-input"
      >
    </div>
    
    <div class="filter-controls">
      <select 
        [(ngModel)]="categoryFilter" 
        (change)="onCategoryFilterChange()"
        class="filter-select"
      >
        <option value="">Todas as Categorias</option>
        <option *ngFor="let category of availableCategories" [value]="category">
          {{ category }}
        </option>
      </select>
      
      <select 
        [(ngModel)]="supplierFilter" 
        (change)="onSupplierFilterChange()"
        class="filter-select"
      >
        <option value="">Todos os Fornecedores</option>
        <option *ngFor="let supplier of suppliers" [value]="supplier.id">
          {{ supplier.name }}
        </option>
      </select>
      
      <select 
        [(ngModel)]="statusFilter" 
        (change)="onStatusFilterChange()"
        class="filter-select"
      >
        <option value="all">Todos os Status</option>
        <option value="active">Ativos</option>
        <option value="inactive">Inativos</option>
      </select>
      
      <select 
        [(ngModel)]="stockFilter" 
        (change)="onStockFilterChange()"
        class="filter-select"
      >
        <option value="all">Todos os Estoques</option>
        <option value="low">Estoque Baixo</option>
        <option value="out">Sem Estoque</option>
      </select>
    </div>
  </div>

  <!-- Tabela de Produtos -->
  <div class="table-container">
    <table class="products-table">
      <thead>
        <tr>
          <th>Produto</th>
          <th>Categoria</th>
          <th>SKU</th>
          <th>Fornecedor</th>
          <th>Estoque</th>
          <th>Preços</th>
          <th>Status</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let product of filteredProducts" class="product-row">
          <td>
            <div class="product-info">
              <strong>{{ product.name }}</strong>
              <span class="description">{{ product.description }}</span>
            </div>
          </td>
          <td>
            <span class="category-badge">{{ product.category }}</span>
          </td>
          <td>
            <span class="sku">{{ product.sku }}</span>
          </td>
          <td>
            <span class="supplier">{{ getSupplierName(product.supplierId) }}</span>
          </td>
          <td>
            <div class="stock-info">
              <span class="current-stock">{{ product.currentStock }} {{ product.unit }}</span>
              <span class="stock-status" [class]="getStockStatusClass(product)">
                {{ getStockStatusText(product) }}
              </span>
            </div>
          </td>
          <td>
            <div class="price-info">
              <span class="cost-price">Custo: {{ formatCurrency(product.costPrice) }}</span>
              <span class="sale-price">Venda: {{ formatCurrency(product.salePrice) }}</span>
            </div>
          </td>
          <td>
            <span class="status-badge" [class]="product.isActive ? 'active' : 'inactive'">
              {{ product.isActive ? 'Ativo' : 'Inativo' }}
            </span>
          </td>
          <td>
            <div class="action-buttons">
              <button class="btn-icon" (click)="viewProduct(product)" title="Visualizar">
                <i class="fas fa-eye"></i>
              </button>
              <button class="btn-icon" (click)="editProduct(product)" title="Editar">
                <i class="fas fa-edit"></i>
              </button>
              <button 
                *ngIf="product.isActive"
                class="btn-icon btn-warning" 
                (click)="deactivateProduct(product)"
                title="Desativar"
              >
                <i class="fas fa-times"></i>
              </button>
              <button 
                *ngIf="!product.isActive"
                class="btn-icon btn-success" 
                (click)="activateProduct(product)"
                title="Ativar"
              >
                <i class="fas fa-check"></i>
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
    
    <div *ngIf="filteredProducts.length === 0" class="no-results">
      <i class="fas fa-search"></i>
      <p>Nenhum produto encontrado com os filtros aplicados.</p>
    </div>
  </div>

  <!-- Formulário de Produto -->
  <div *ngIf="showForm" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-header">
        <h2>{{ isCreating ? 'Novo Produto' : 'Editar Produto' }}</h2>
        <button class="btn-close" (click)="closeForm()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <form [formGroup]="productForm" (ngSubmit)="saveProduct()" class="product-form">
        <div class="form-row">
          <div class="form-group">
            <label for="category">Categoria *</label>
            <select id="category" formControlName="category" class="form-select">
              <option value="">Selecione uma categoria</option>
              <option *ngFor="let category of availableCategories" [value]="category">
                {{ category }}
              </option>
            </select>
            <div *ngIf="productForm.get('category')?.invalid && productForm.get('category')?.touched" class="error-message">
              Categoria é obrigatória
            </div>
          </div>
          
          <div class="form-group">
            <label for="name">Nome *</label>
            <input 
              type="text" 
              id="name" 
              formControlName="name" 
              placeholder="Nome do produto"
              class="form-input"
            >
            <div *ngIf="productForm.get('name')?.invalid && productForm.get('name')?.touched" class="error-message">
              Nome é obrigatório e deve ter pelo menos 3 caracteres
            </div>
          </div>
        </div>
        
        <div class="form-group">
          <label for="description">Descrição *</label>
          <textarea 
            id="description" 
            formControlName="description" 
            placeholder="Descrição detalhada do produto"
            class="form-textarea"
            rows="3"
          ></textarea>
          <div *ngIf="productForm.get('description')?.invalid && productForm.get('description')?.touched" class="error-message">
            Descrição é obrigatória e deve ter pelo menos 10 caracteres
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="sku">SKU *</label>
            <input 
              type="text" 
              id="sku" 
              formControlName="sku" 
              placeholder="Código do produto"
              class="form-input"
            >
            <div *ngIf="productForm.get('sku')?.invalid && productForm.get('sku')?.touched" class="error-message">
              SKU é obrigatório e deve ter pelo menos 3 caracteres
            </div>
          </div>
          
          <div class="form-group">
            <label for="unit">Unidade *</label>
            <select id="unit" formControlName="unit" class="form-select">
              <option value="">Selecione uma unidade</option>
              <option *ngFor="let unit of availableUnits" [value]="unit">
                {{ unit }}
              </option>
            </select>
            <div *ngIf="productForm.get('unit')?.invalid && productForm.get('unit')?.touched" class="error-message">
              Unidade é obrigatória
            </div>
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="costPrice">Preço de Custo *</label>
            <input 
              type="number" 
              id="costPrice" 
              formControlName="costPrice" 
              placeholder="0.00"
              class="form-input"
              step="0.01"
              min="0"
            >
            <div *ngIf="productForm.get('costPrice')?.invalid && productForm.get('costPrice')?.touched" class="error-message">
              Preço de custo é obrigatório e deve ser maior que zero
            </div>
          </div>
          
          <div class="form-group">
            <label for="salePrice">Preço de Venda *</label>
            <input 
              type="number" 
              id="salePrice" 
              formControlName="salePrice" 
              placeholder="0.00"
              class="form-input"
              step="0.01"
              min="0"
            >
            <div *ngIf="productForm.get('salePrice')?.invalid && productForm.get('salePrice')?.touched" class="error-message">
              Preço de venda é obrigatório e deve ser maior que zero
            </div>
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="currentStock">Estoque Atual *</label>
            <input 
              type="number" 
              id="currentStock" 
              formControlName="currentStock" 
              placeholder="0"
              class="form-input"
              min="0"
            >
            <div *ngIf="productForm.get('currentStock')?.invalid && productForm.get('currentStock')?.touched" class="error-message">
              Estoque atual é obrigatório e deve ser maior ou igual a zero
            </div>
          </div>
          
          <div class="form-group">
            <label for="minStock">Estoque Mínimo *</label>
            <input 
              type="number" 
              id="minStock" 
              formControlName="minStock" 
              placeholder="0"
              class="form-input"
              min="0"
            >
            <div *ngIf="productForm.get('minStock')?.invalid && productForm.get('minStock')?.touched" class="error-message">
              Estoque mínimo é obrigatório e deve ser maior ou igual a zero
            </div>
          </div>
        </div>
        
        <div class="form-group">
          <label for="supplierId">Fornecedor *</label>
          <select id="supplierId" formControlName="supplierId" class="form-select">
            <option value="">Selecione um fornecedor</option>
            <option *ngFor="let supplier of suppliers" [value]="supplier.id">
              {{ supplier.name }}
            </option>
          </select>
          <div *ngIf="productForm.get('supplierId')?.invalid && productForm.get('supplierId')?.touched" class="error-message">
            Fornecedor é obrigatório
          </div>
        </div>
        
        <div class="form-actions">
          <button type="button" class="btn-secondary" (click)="closeForm()">
            Cancelar
          </button>
          <button type="submit" class="btn-primary" [disabled]="productForm.invalid">
            {{ isCreating ? 'Criar' : 'Salvar' }}
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal de Fornecedor -->
  <div *ngIf="showSupplierForm" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Novo Fornecedor</h2>
        <button class="btn-close" (click)="closeSupplierForm()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <form [formGroup]="supplierForm" (ngSubmit)="saveSupplier()" class="supplier-form">
        <div class="form-row">
          <div class="form-group">
            <label for="supplierName">Nome *</label>
            <input 
              type="text" 
              id="supplierName" 
              formControlName="name" 
              placeholder="Nome da empresa"
              class="form-input"
            >
            <div *ngIf="supplierForm.get('name')?.invalid && supplierForm.get('name')?.touched" class="error-message">
              Nome é obrigatório e deve ter pelo menos 3 caracteres
            </div>
          </div>
          
          <div class="form-group">
            <label for="document">CPF/CNPJ *</label>
            <input 
              type="text" 
              id="document" 
              formControlName="document" 
              placeholder="000.000.000-00 ou 00.000.000/0000-00"
              class="form-input"
            >
            <div *ngIf="supplierForm.get('document')?.invalid && supplierForm.get('document')?.touched" class="error-message">
              Documento é obrigatório e deve ter pelo menos 11 caracteres
            </div>
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="contact">Contato *</label>
            <input 
              type="text" 
              id="contact" 
              formControlName="contact" 
              placeholder="Nome do contato"
              class="form-input"
            >
            <div *ngIf="supplierForm.get('contact')?.invalid && supplierForm.get('contact')?.touched" class="error-message">
              Contato é obrigatório e deve ter pelo menos 3 caracteres
            </div>
          </div>
          
          <div class="form-group">
            <label for="phone">Telefone *</label>
            <input 
              type="text" 
              id="phone" 
              formControlName="phone" 
              placeholder="(11) 99999-9999"
              class="form-input"
            >
            <div *ngIf="supplierForm.get('phone')?.invalid && supplierForm.get('phone')?.touched" class="error-message">
              Telefone é obrigatório no formato (11) 99999-9999
            </div>
          </div>
        </div>
        
        <div class="form-group">
          <label for="email">E-mail *</label>
          <input 
            type="email" 
            id="email" 
            formControlName="email" 
            placeholder="email@exemplo.com"
            class="form-input"
          >
          <div *ngIf="supplierForm.get('email')?.invalid && supplierForm.get('email')?.touched" class="error-message">
            E-mail é obrigatório e deve ser válido
          </div>
        </div>
        
        <div class="form-group">
          <label for="address">Endereço *</label>
          <textarea 
            id="address" 
            formControlName="address" 
            placeholder="Endereço completo"
            class="form-textarea"
            rows="2"
          ></textarea>
          <div *ngIf="supplierForm.get('address')?.invalid && supplierForm.get('address')?.touched" class="error-message">
            Endereço é obrigatório e deve ter pelo menos 10 caracteres
          </div>
        </div>
        
        <div class="form-actions">
          <button type="button" class="btn-secondary" (click)="closeSupplierForm()">
            Cancelar
          </button>
          <button type="submit" class="btn-primary" [disabled]="supplierForm.invalid">
            Criar
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal de Movimentação de Estoque -->
  <div *ngIf="showStockMovementForm" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Nova Movimentação de Estoque</h2>
        <button class="btn-close" (click)="closeStockMovementForm()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <form [formGroup]="stockMovementForm" (ngSubmit)="saveStockMovement()" class="stock-movement-form">
        <div class="form-row">
          <div class="form-group">
            <label for="movementProductId">Produto *</label>
            <select id="movementProductId" formControlName="productId" class="form-select">
              <option value="">Selecione um produto</option>
              <option *ngFor="let product of products" [value]="product.id">
                {{ product.name }} ({{ product.sku }})
              </option>
            </select>
            <div *ngIf="stockMovementForm.get('productId')?.invalid && stockMovementForm.get('productId')?.touched" class="error-message">
              Produto é obrigatório
            </div>
          </div>
          
          <div class="form-group">
            <label for="type">Tipo *</label>
            <select id="type" formControlName="type" class="form-select">
              <option value="">Selecione o tipo</option>
              <option value="entry">Entrada</option>
              <option value="exit">Saída</option>
            </select>
            <div *ngIf="stockMovementForm.get('type')?.invalid && stockMovementForm.get('type')?.touched" class="error-message">
              Tipo é obrigatório
            </div>
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="quantity">Quantidade *</label>
            <input 
              type="number" 
              id="quantity" 
              formControlName="quantity" 
              placeholder="0"
              class="form-input"
              min="1"
            >
            <div *ngIf="stockMovementForm.get('quantity')?.invalid && stockMovementForm.get('quantity')?.touched" class="error-message">
              Quantidade é obrigatória e deve ser maior que zero
            </div>
          </div>
          
          <div class="form-group">
            <label for="unitPrice">Preço Unitário *</label>
            <input 
              type="number" 
              id="unitPrice" 
              formControlName="unitPrice" 
              placeholder="0.00"
              class="form-input"
              step="0.01"
              min="0"
            >
            <div *ngIf="stockMovementForm.get('unitPrice')?.invalid && stockMovementForm.get('unitPrice')?.touched" class="error-message">
              Preço unitário é obrigatório e deve ser maior ou igual a zero
            </div>
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="reason">Motivo *</label>
            <select id="reason" formControlName="reason" class="form-select">
              <option value="">Selecione o motivo</option>
              <option *ngFor="let reason of stockMovementReasons" [value]="reason">
                {{ getReasonText(reason) }}
              </option>
            </select>
            <div *ngIf="stockMovementForm.get('reason')?.invalid && stockMovementForm.get('reason')?.touched" class="error-message">
              Motivo é obrigatório
            </div>
          </div>
          
      
        </div>
        
        <div class="form-group">
          <label for="notes">Observações</label>
          <textarea 
            id="notes" 
            formControlName="notes" 
            placeholder="Observações sobre a movimentação"
            class="form-textarea"
            rows="2"
          ></textarea>
        </div>
        
        <div class="form-actions">
          <button type="button" class="btn-secondary" (click)="closeStockMovementForm()">
            Cancelar
          </button>
          <button type="submit" class="btn-primary" [disabled]="stockMovementForm.invalid">
            Criar
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal de Visualização -->
  <div *ngIf="selectedProduct && !showForm && !showSupplierForm && !showStockMovementForm" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Detalhes do Produto</h2>
        <button class="btn-close" (click)="selectedProduct = null">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="product-details">
        <div class="detail-row">
          <label>Nome:</label>
          <span>{{ selectedProduct.name }}</span>
        </div>
        <div class="detail-row">
          <label>Descrição:</label>
          <span>{{ selectedProduct.description }}</span>
        </div>
        <div class="detail-row">
          <label>Categoria:</label>
          <span class="category-badge">{{ selectedProduct.category }}</span>
        </div>
        <div class="detail-row">
          <label>SKU:</label>
          <span class="sku">{{ selectedProduct.sku }}</span>
        </div>
        <div class="detail-row">
          <label>Unidade:</label>
          <span>{{ selectedProduct.unit }}</span>
        </div>
        <div class="detail-row">
          <label>Fornecedor:</label>
          <span>{{ getSupplierName(selectedProduct.supplierId) }}</span>
        </div>
        <div class="detail-row">
          <label>Estoque Atual:</label>
          <span class="current-stock">{{ selectedProduct.currentStock }} {{ selectedProduct.unit }}</span>
        </div>
        <div class="detail-row">
          <label>Estoque Mínimo:</label>
          <span>{{ selectedProduct.minStock }} {{ selectedProduct.unit }}</span>
        </div>
        <div class="detail-row">
          <label>Status do Estoque:</label>
          <span class="stock-status" [class]="getStockStatusClass(selectedProduct)">
            {{ getStockStatusText(selectedProduct) }}
          </span>
        </div>
        <div class="detail-row">
          <label>Preço de Custo:</label>
          <span class="cost-price">{{ formatCurrency(selectedProduct.costPrice) }}</span>
        </div>
        <div class="detail-row">
          <label>Preço de Venda:</label>
          <span class="sale-price">{{ formatCurrency(selectedProduct.salePrice) }}</span>
        </div>
        <div class="detail-row">
          <label>Status:</label>
          <span class="status-badge" [class]="selectedProduct.isActive ? 'active' : 'inactive'">
            {{ selectedProduct.isActive ? 'Ativo' : 'Inativo' }}
          </span>
        </div>
        <div class="detail-row">
          <label>Data de Cadastro:</label>
          <span>{{ selectedProduct.createdAt | date:'dd/MM/yyyy' }}</span>
        </div>
        <div class="detail-row">
          <label>Última Atualização:</label>
          <span>{{ selectedProduct.updatedAt | date:'dd/MM/yyyy' }}</span>
        </div>
      </div>
      
      <div class="modal-actions">
        <button class="btn-secondary" (click)="selectedProduct = null">
          Fechar
        </button>
        <button class="btn-primary" (click)="editProduct(selectedProduct)">
          Editar
        </button>
        <button 
          *ngIf="selectedProduct.isActive"
          class="btn-warning" 
          (click)="deactivateProduct(selectedProduct)"
        >
          Desativar
        </button>
        <button 
          *ngIf="!selectedProduct.isActive"
          class="btn-success" 
          (click)="activateProduct(selectedProduct)"
        >
          Ativar
        </button>
      </div>
    </div>
  </div>
</div>
