<div class="services-container">
  <!-- Header da Página -->
  <div class="page-header">
    <div class="header-content">
      <h1>Gestão de Serviços</h1>
      <div class="header-actions">
        <button class="btn-secondary" (click)="createAdditionalService()">
          <i class="fas fa-plus"></i>
          Serviço Adicional
        </button>
        <button class="btn-primary" (click)="createService()">
          <i class="fas fa-plus"></i>
          Novo Serviço
        </button>
      </div>
    </div>
  </div>

  <!-- Estatísticas -->
  <div class="stats-section">
    <div class="stat-card">
      <div class="stat-icon">
        <i class="fas fa-tools"></i>
      </div>
      <div class="stat-content">
        <h3>{{ stats.total }}</h3>
        <p>Total de Serviços</p>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon active">
        <i class="fas fa-check-circle"></i>
      </div>
      <div class="stat-content">
        <h3>{{ stats.active }}</h3>
        <p>Serviços Ativos</p>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon inactive">
        <i class="fas fa-times-circle"></i>
      </div>
      <div class="stat-content">
        <h3>{{ stats.inactive }}</h3>
        <p>Serviços Inativos</p>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon revenue">
        <i class="fas fa-dollar-sign"></i>
      </div>
      <div class="stat-content">
        <h3>{{ formatCurrency(stats.totalRevenue) }}</h3>
        <p>Receita Total</p>
      </div>
    </div>
  </div>

  <!-- Filtros e Busca -->
  <div class="filters-section">
    <div class="search-box">
      <i class="fas fa-search"></i>
      <input type="text" placeholder="Buscar por nome ou descrição..." [(ngModel)]="searchTerm"
        (input)="onSearchChange()" class="search-input">
    </div>

    <div class="filter-controls">
      <select [(ngModel)]="categoryFilter" (change)="onCategoryFilterChange()" class="filter-select">
        <option value="">Todas as Categorias</option>
        <option *ngFor="let category of availableCategories" [value]="category">
          {{ getCategoryText(category) }}
        </option>
      </select>

      <select [(ngModel)]="statusFilter" (change)="onStatusFilterChange()" class="filter-select">
        <option value="all">Todos os Status</option>
        <option value="active">Ativos</option>
        <option value="inactive">Inativos</option>
      </select>
    </div>
  </div>

  <!-- Tabela de Serviços -->
  <div class="table-container">
    <table class="services-table">
      <thead>
        <tr>
          <th>Nome</th>
          <th>Cliente</th>
          <th>Categoria</th>
          <th>Preço Base</th>
          <th>Preço Total</th>
          <th>Serviços Adicionais</th>
          <th>Status</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let service of paginatedServices" class="service-row">
          <td>
            <div class="service-info">
              <strong>{{ service.name }}</strong>
            </div>
          </td>
          <td>
            <span>{{ getCustomerNameById(service.customerId) }}</span>
          </td>
          <td>
            <span class="category-badge" [class]="getCategoryBadgeClass(service.category)">
              {{ getCategoryText(service.category) }}
            </span>
          </td>
          <td>
            <span class="base-price">{{ formatCurrency(service.basePrice) }}</span>
          </td>
          <td>
            <span class="total-price">{{ formatCurrency(calculateServiceTotal(service)) }}</span>
          </td>
          <td>
            <span class="additional-services">{{ getAdditionalServicesText(service) }}</span>
          </td>
          <td>
            <span class="status-badge" [class]="getStatusBadgeClass(service)">
              {{ getStatusText(service) }}
            </span>
          </td>
          <td>
            <div class="action-buttons">
              <button class="btn-icon" (click)="viewService(service)" title="Visualizar">
                <i class="fas fa-eye"></i>
              </button>
              <button class="btn-icon" (click)="editService(service)" title="Editar">
                <i class="fas fa-edit"></i>
              </button>
              <button *ngIf="service.isActive" class="btn-icon btn-warning" (click)="deactivateService(service)"
                title="Desativar">
                <i class="fas fa-times"></i>
              </button>
              <button *ngIf="!service.isActive" class="btn-icon btn-success" (click)="activateService(service)"
                title="Ativar">
                <i class="fas fa-check"></i>
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>

    <div *ngIf="filteredServices.length === 0" class="no-results">
      <i class="fas fa-search"></i>
      <p>Nenhum serviço encontrado com os filtros aplicados.</p>
    </div>

    <!-- Paginação -->
    <app-pagination [currentPage]="currentPage" [pageSize]="pageSize" [totalItems]="filteredServices.length"
      (pageChange)="onPageChange($event)">
    </app-pagination>
  </div>

  <!-- Formulário de Serviço -->
  <div *ngIf="showForm" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-header">
        <h2>{{ isCreating ? 'Novo Serviço' : 'Editar Serviço' }}</h2>
        <button class="btn-close" (click)="closeForm()">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <form [formGroup]="serviceForm" (ngSubmit)="saveService()" class="service-form">
        <div class="form-row">
          <div class="form-group">
            <label for="name">Nome *</label>
            <input type="text" id="name" formControlName="name" placeholder="Nome do serviço" class="form-input">
            <div *ngIf="serviceForm.get('name')?.invalid && serviceForm.get('name')?.touched" class="error-message">
              Nome é obrigatório e deve ter pelo menos 3 caracteres
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="customerId">Cliente *</label>
              <select id="customerId" formControlName="customerId" class="form-select">
                <option value="">Selecione um cliente</option>
                <option *ngFor="let customer of customers" [value]="customer.id">
                  {{ customer.name }} - {{ customer.phone }}
                </option>
              </select>
              <div *ngIf="serviceForm.get('customerId')?.invalid && serviceForm.get('customerId')?.touched"
                class="error-message">
                Cliente é obrigatório
              </div>
            </div>
          </div>

          <div class="form-group">
            <label for="category">Categoria *</label>
            <select id="category" formControlName="category" class="form-select">
              <option value="">Selecione uma categoria</option>
              <option *ngFor="let category of availableCategories" [value]="category">
                {{ getCategoryText(category) }}
              </option>
            </select>
            <div *ngIf="serviceForm.get('category')?.invalid && serviceForm.get('category')?.touched"
              class="error-message">
              Categoria é obrigatória
            </div>
          </div>
        </div>

        <div class="form-group">
          <label for="description">Descrição *</label>
          <textarea id="description" formControlName="description" placeholder="Descrição detalhada do serviço"
            class="form-textarea" rows="3"></textarea>
          <div *ngIf="serviceForm.get('description')?.invalid && serviceForm.get('description')?.touched"
            class="error-message">
            Descrição é obrigatória e deve ter pelo menos 10 caracteres
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="basePrice">Preço Base *</label>
            <input type="number" id="basePrice" formControlName="basePrice" placeholder="0.00" class="form-input"
              step="0.01" min="0">
            <div *ngIf="serviceForm.get('basePrice')?.invalid && serviceForm.get('basePrice')?.touched"
              class="error-message">
              Preço base é obrigatório e deve ser maior que zero
            </div>
          </div>
        </div>

        <div class="form-group">
          <label>Serviços Adicionais</label>
          <div class="additional-services-grid">
            <div *ngFor="let additional of additionalServices" class="additional-service-item"
              [class.selected]="isAdditionalServiceSelected(additional.id)"
              (click)="toggleAdditionalService(additional.id)">
              <div class="additional-service-header">
                <input type="checkbox" [checked]="isAdditionalServiceSelected(additional.id)"
                  (change)="toggleAdditionalService(additional.id)" class="additional-checkbox">
                <span class="additional-name">{{ additional.name }}</span>
                <span class="additional-price">+{{ formatCurrency(additional.additionalPrice) }}</span>
              </div>
              <p class="additional-description">{{ additional.description }}</p>
            </div>
          </div>
        </div>

        <div class="form-actions">
          <button type="button" class="btn-secondary" (click)="closeForm()">
            Cancelar
          </button>
          <button type="submit" class="btn-primary" [disabled]="serviceForm.invalid">
            {{ isCreating ? 'Criar' : 'Salvar' }}
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal de Serviço Adicional -->
  <div *ngIf="showAdditionalServiceForm" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Novo Serviço Adicional</h2>
        <button class="btn-close" (click)="closeAdditionalServiceForm()">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <form [formGroup]="additionalServiceForm" (ngSubmit)="saveAdditionalService()" class="additional-service-form">
        <div class="form-group">
          <label for="additionalName">Nome *</label>
          <input type="text" id="additionalName" formControlName="name" placeholder="Nome do serviço adicional"
            class="form-input">
          <div *ngIf="additionalServiceForm.get('name')?.invalid && additionalServiceForm.get('name')?.touched"
            class="error-message">
            Nome é obrigatório e deve ter pelo menos 3 caracteres
          </div>
        </div>

        <div class="form-group">
          <label for="additionalDescription">Descrição *</label>
          <textarea id="additionalDescription" formControlName="description"
            placeholder="Descrição do serviço adicional" class="form-textarea" rows="3"></textarea>
          <div
            *ngIf="additionalServiceForm.get('description')?.invalid && additionalServiceForm.get('description')?.touched"
            class="error-message">
            Descrição é obrigatória e deve ter pelo menos 10 caracteres
          </div>
        </div>

        <div class="form-group">
          <label for="additionalPrice">Preço Adicional *</label>
          <input type="number" id="additionalPrice" formControlName="additionalPrice" placeholder="0.00"
            class="form-input" step="0.01" min="0">
          <div
            *ngIf="additionalServiceForm.get('additionalPrice')?.invalid && additionalServiceForm.get('additionalPrice')?.touched"
            class="error-message">
            Preço adicional é obrigatório e deve ser maior que zero
          </div>
        </div>

        <div class="form-actions">
          <button type="button" class="btn-secondary" (click)="closeAdditionalServiceForm()">
            Cancelar
          </button>
          <button type="submit" class="btn-primary" [disabled]="additionalServiceForm.invalid">
            Criar
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal de Visualização -->
  <div *ngIf="selectedService && !showForm && !showAdditionalServiceForm" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Detalhes do Serviço</h2>
        <button class="btn-close" (click)="selectedService = null">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <div class="service-details">
        <div class="detail-row">
          <label>Nome:</label>
          <span>{{ selectedService.name }}</span>
        </div>
        <div class="detail-row">
          <label>Cliente:</label>
          <span>{{ getCustomerNameById(selectedService.customerId) }}</span>
        </div>
        <div class="detail-row">
          <label>Categoria:</label>
          <span class="category-badge" [class]="getCategoryBadgeClass(selectedService.category)">
            {{ getCategoryText(selectedService.category) }}
          </span>
        </div>
        <div class="detail-row">
          <label>Preço Base:</label>
          <span class="base-price">{{ formatCurrency(selectedService.basePrice) }}</span>
        </div>
        <div class="detail-row">
          <label>Preço Total:</label>
          <span class="total-price">{{ formatCurrency(calculateServiceTotal(selectedService)) }}</span>
        </div>
        <div class="detail-row">
          <label>Serviços Adicionais:</label>
          <span>{{ getAdditionalServicesText(selectedService) }}</span>
        </div>
        <div class="detail-row">
          <label>Status:</label>
          <span class="status-badge" [class]="getStatusBadgeClass(selectedService)">
            {{ getStatusText(selectedService) }}
          </span>
        </div>
        <div class="detail-row">
          <label>Data de Cadastro:</label>
          <span>{{ selectedService.createdAt | date:'dd/MM/yyyy' }}</span>
        </div>
        <div class="detail-row">
          <label>Última Atualização:</label>
          <span>{{ selectedService.updatedAt | date:'dd/MM/yyyy' }}</span>
        </div>
      </div>

      <div class="modal-actions">
        <button class="btn-secondary" (click)="selectedService = null">
          Fechar
        </button>
        <button class="btn-primary" (click)="editService(selectedService)">
          Editar
        </button>
        <button *ngIf="selectedService.isActive" class="btn-warning" (click)="deactivateService(selectedService)">
          Desativar
        </button>
        <button *ngIf="!selectedService.isActive" class="btn-success" (click)="activateService(selectedService)">
          Ativar
        </button>
      </div>
    </div>
  </div>
</div>